<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>AltText AI · Provider Dashboard</title>
    <link rel="stylesheet" href="/public/css/provider-dashboard.css" />
  </head>
  <body>
    <header class="layout-header">
      <div class="layout-header__inner">
        <div>
          <h1>AltText AI Provider Dashboard</h1>
          <p class="layout-header__meta">Generated <%= generatedAt %></p>
        </div>
        <div class="totals">
          <div>
            <span class="totals__label">Tokens (30 days)</span>
            <strong><%= totals.tokens.toLocaleString() %></strong>
          </div>
          <div>
            <span class="totals__label">MTD Revenue</span>
            <strong>£<%= totals.revenue %></strong>
          </div>
          <div>
            <span class="totals__label">MTD Cost</span>
            <strong>£<%= totals.costUsd %></strong>
          </div>
          <div>
            <span class="totals__label">MTD Profit</span>
            <strong>£<%= totals.profit %></strong>
          </div>
        </div>
      </div>
    </header>

    <main class="layout-main">
      <section class="table-card">
        <header class="table-card__header">
          <div>
            <h2>Installations</h2>
            <p class="table-card__subtitle">
              Showing <%= installations.length %> of <%= meta.total %> installations. Profit values use configured plan pricing and estimated OpenAI costs.
            </p>
          </div>
        </header>
        <div class="table-card__body">
          <table class="usage-table">
            <thead>
              <tr>
                <th>Install ID</th>
                <th>User Email</th>
                <th>Plan</th>
                <th>Tokens 30d</th>
                <th>Revenue (MTD)</th>
                <th>Cost (MTD)</th>
                <th>Profit (MTD)</th>
                <th>Last Seen</th>
              </tr>
            </thead>
            <tbody>
              <% if (installations.length === 0) { %>
                <tr>
                  <td colspan="8" class="usage-table__empty">No installations have reported usage yet.</td>
                </tr>
              <% } %>
              <% installations.forEach((install) => { %>
                <tr>
                  <td><code class="usage-table__code"><%= install.installId %></code></td>
                  <td><%= install.userEmail %></td>
                  <td class="usage-table__plan usage-table__plan--<%= install.plan %>"><%= install.plan %></td>
                  <td><%= install.tokens30d.toLocaleString() %></td>
                  <td>£<%= (install.revenueCents / 100).toFixed(2) %></td>
                  <td>£<%= (install.costMicros / 1_000_000).toFixed(4) %></td>
                  <td class="<%= install.profitCents >= 0 ? 'profit-positive' : 'profit-negative' %>">
                    £<%= (install.profitCents / 100).toFixed(2) %>
                  </td>
                  <td><%= install.lastSeen.toISOString ? install.lastSeen.toISOString() : install.lastSeen %></td>
                </tr>
              <% }); %>
            </tbody>
          </table>
        </div>
      </section>
    </main>

    <footer class="layout-footer">
      <p>&copy; <%= new Date().getFullYear() %> AltText AI — Internal Use Only</p>
    </footer>
  </body>
</html>
